<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
	<meta name="description" content="">
	<meta name="author" content="">
	<link rel="icon" href="assets/favicon.ico">

	<title>smartFIT CORE portal</title>

	<!-- Bootstrap core CSS -->
	<link rel="stylesheet" type="text/css" href="tools/bootstrap/bootstrap.min.css">

	<!-- JQuery scripts -->
	<script src="tools/jquery/jquery-3.3.1.min.js"></script>

	<!-- GaugeMeter -->
	<script type="application/javascript" src="tools/GaugeMeter/GaugeMeter.js"></script>
	<link rel="stylesheet" type="text/css" href="tools/GaugeMeter/gaugemeter.css">

	<!-- chartjs -->
	<script type="application/javascript" src="tools/chartjs/chart.min.js"></script>
	<script type="application/javascript" src="tools/chartjs/chartjs-adapter-date.min.js"></script>

	<!-- hammerjs (needs to be included before plugin zoom)-->
	<script type="application/javascript" src="tools/hammerjs/hammer.min.js"></script>

	<!-- chartjs-plugin-zoom -->
	<script type="application/javascript" src="tools/chartjs/chartjs-plugin-zoom.min.js"></script>


	<!-- jspdf -->
	<script type="application/javascript" src="tools/jspdf/pdf.min.js"></script>
	<script type="text/javascript" src="tools/jspdf/jspdf.debug.js"></script>

	<!-- sheetjs -->
	<script type="application/javascript" src="tools/sheet/xlsx.mini.min.js"></script>

	<!-- daterangepicker -->
	<script type="application/javascript" src="tools/easepick/datetime.index.umd.min.js"></script>
	<script type="application/javascript" src="tools/easepick/core.index.umd.min.js"></script>
	<script type="application/javascript" src="tools/easepick/base.plugin.index.umd.min.js"></script>
	<script type="application/javascript" src="tools/easepick/range.plugin.index.umd.min.js"></script>
	<script type="application/javascript" src="tools/easepick/preset.plugin.index.umd.min.js"></script>

	<!-- JSON-RPC -->
	<!-- <script type="application/javascript" src="tools/jsonrpc/jsonrpc.min.js"></script> -->

	<!-- JSON-RPC Websocket-->
	<script type="application/javascript" src="tools/jsonrpc/jsonrpc_ws.js"></script>


	<!-- APP -->
	<script type="application/javascript" src="js/home.js"></script>
	<script type="application/javascript" src="js/user.js"></script>
	<script type="application/javascript" src="js/dash.js"></script>
	<script type="application/javascript" src="js/graphs.js"></script>
	<script type="application/javascript" src="js/network.js"></script>
	<script type="application/javascript" src="js/cloud.js"></script>
	<script type="application/javascript" src="js/mqtt.js"></script>
	<script type="application/javascript" src="js/modbustcp_server.js"></script>
	<script type="application/javascript" src="js/azure.js"></script>
	<script type="application/javascript" src="js/events.js"></script>
	<script type="application/javascript" src="js/settings.js"></script>
	<script type="application/javascript" src="js/system.js"></script>
	<script type="application/javascript" src="js/about.js"></script>

	<!-- Application initialization -->
	<link rel="stylesheet" type="text/css" href="css/led.css">
	<link rel="stylesheet" type="text/css" href="css/style.css">
	<script type="application/javascript">

		/* Index class */
		// This class is the main class of the application
		// It initializes the application and runs it
		// - language switching
		// - heap info
		// - connection status
		// - async data
		class Index {
			constructor() {

				// Create the JSON-RPC object
				//let websocket_url =		"ws://10.0.11.143/ws"; 						// direct link - for local webhosting #DEBUG
				let websocket_url = 	"ws://" + window.location.hostname + "/ws";
				this.jrpc = new jsonRPC_ws(websocket_url); // Create the JSON-RPC object

				// Set the event handlers
				this.jrpc.onDisconnected = this.onDisconnected; // disconnected from device
				this.jrpc.onConnected = this.onConnected; // connected to device
				this.jrpc.onAsyncData = this.onAsyncData; // receve async messages

				// Initialize the application
				this.lang = "de";
				this.user = new User(this.jrpc, this.lang);
				this.home = new Home(this.jrpc, this.user, this.lang);

			}
						
			/** Run the application */
			run() {
				// Set the language of the page
				this.setLanguage(this.lang);

				// Run the application
				this.home.run();
				this.user.run();

				// Get heap info
				this.getHeapInfo();
			}

			/** Handle async data
			* @param {string} data - async data
			*/
			onAsyncData(data) {
				// Handle async data
				console.log("Async data: " + data);

				//this.home.dashboard.onAsyncData(data);
				//this.home.graphs.onAsyncData(data);
				//this.home.network.onAsyncData(data);
			}

			/** Set the language of the page
			* @param {string} lang - language "de" or "en"
			*/
			setLanguage(lang) {
				this.lang = lang;
				this.user.setLanguage(lang);
				this.home.setLanguage(lang);
			}

			/** Get heap info from the device and set hidden field 
			 * to display the heap info in the footer
			*/
			getHeapInfo() {
				// Get heap size
				this.jrpc.call('system.getHeapSize').then(function (result) {
					$('#home_heap_info').text("Free RAM: " + result["heap"] + " Bytes");
				});

				// Get heap info every second
				var that = this;
				setTimeout(function () {
					that.getHeapInfo();
				}, 1000);
			}

			/* *Set the connection status "Connected" */
			onConnected() {
				//console.log("Connected to device");
				$('#device_disconnected_text').hide();
				$('#device_connected_text').show();
				$('#connected_led_type').removeClass("led-red-blink");
				$('#connected_led_type').addClass("led-green-on");
			}

			/** Set the connection status "Disconnected" */
			onDisconnected() {
				console.log("Disconnected from device");
				$('#device_disconnected_text').show();
				$('#device_connected_text').hide();
				$('#connected_led_type').removeClass("led-green-on");
				$('#connected_led_type').addClass("led-red-blink");

			}
		};

		// Create the index object
		var index = new Index();

		// Run the application
		$(document).ready(function () {

			// Language switch
			$('#switch-lang-en').click(function () {
				$('#switch-lang-en').addClass('active');
				$('#switch-lang-de').removeClass('active');
				index.setLanguage("en");
			});
			$('#switch-lang-de').click(function () {
				$('#switch-lang-en').removeClass('active');
				$('#switch-lang-de').addClass('active');
				index.setLanguage("de");
			});

			// Login button
			$('#btn_login').click(function () {
				$('#btn_login').addClass("display-none");
				$('#btn_home').removeClass("display-none");
			});

			// Home button
			$('#btn_home').click(function () {
				$('#btn_login').removeClass("display-none");
				$('#btn_home').addClass("display-none");
				index.home.refresh();
			});

			index.run(); // Start the application
		});

	</script>


</head>

<body>
	<!-- Modal Success-->
	<div class="modal fade" id="modal_success" tabindex="-1" role="dialog" aria-labelledby="modal_successLabel"
		aria-hidden="false">
		<div class="modal-dialog" role="document">
			<div class="alert alert-success">
				<strong>
					<span class="lang-de">Erfolgreich! </span>
					<span class="lang-en">Success! </span>
				</strong>
				<span id="modal_success_text_en" class="lang-en"></span>
				<span id="modal_success_text_de" class="lang-de"></span>
			</div>
		</div>
	</div>

	<!-- Modal Error-->
	<div class="modal fade" id="modal_error" tabindex="-1" role="dialog" aria-labelledby="modal_errorLabel"
		aria-hidden="false">
		<div class="modal-dialog" role="document">
			<div class="alert alert-danger">
				<strong>
					<span class="lang-de">Fehler! </span>
					<span class="lang-en">Error! </span>
				</strong>
				<span id="modal_error_text_en" class="lang-en"></span>
				<span id="modal_error_text_de" class="lang-de"></span>
			</div>
		</div>
	</div>


	<style>
		/* (This) PAGE SPECIFFIC CSS */
		.login {
			padding-left: 20px;
			padding-right: 20px;
			padding-top: 10px;
			padding-bottom: 10px;
		}

		#connected_text {
			padding-right: 20px;
			margin: 10px 0;
			float: left;
			/* add this */
			/*border: 1px solid red;*/
		}

		#connected_led {
			margin-top: 5px;
			/*border: 1px solid green;*/
			float: left;
			/* add this */
		}
	</style>

	<header class="d-flex justify-content-between" style="overflow: hidden;">

		<div id="status_div" style="padding-left: 4%; font-size: 14px;">
			<div>
				<div id="connected_text" style="color: white; margin-top: 9px; text-size-adjust: auto;">
					<span id="device_connected_text" style="display: none !important;">
						<span class="lang-de">Verbunden</span>
						<span class="lang-en">Connected</span>
					</span>
					<span id="device_disconnected_text">
						<span class="lang-de">Getrennt</span>
						<span class="lang-en">Disconnected</span>
					</span>
				</div>

				<div id="connected_led" class="led-box">
					<div id="connected_led_type" class="led-basic led-red-blink" style="left: -10px;"></div>
				</div>
			</div>
		</div>

		<div style="position: absolute; left: 50%;">
			<div
				style="text-align: center; color: white; top: 7px; font-weight: bold; position: relative; left: -50%; ">
				<span id="switch-lang-en" class="page-item" style="cursor: pointer;">En</span>
				<span style="margin-left: 10px; margin-right: 10px;">|</span>
				<span id="switch-lang-de" class="page-item" style="cursor: pointer;">De</span>
			</div>
		</div>


		<div class="float-right">
			<ul class="nav" id="myTab" role="tablist" style=" margin-left: 30px;">
				<li id="btn_home" class="nav-item display-none">
					<a class="nav-link active login login-false" id="home-tab" data-toggle="tab" href="#home" role="tab"
						aria-controls="home" aria-selected="true"><img src="assets/upper_left.png" width="20"
							height="20" class="d-inline-block align-top" alt=""
							style="opacity:0.65; margin-right: 7px;" /><span>Home</span></a>
				</li>
				<li id="btn_login" class="nav-item">
					<a class="nav-link login login-false" id="user-tab" data-toggle="tab" href="#user" role="tab"
						aria-controls="user" aria-selected="false"><img src="assets/user.png" width="20" height="20"
							class="d-inline-block align-top" alt="" style="opacity:0.65; margin-right: 7px;" /><span
							id="btn_span_user">Login</span></a>
				</li>
			</ul>
		</div>
	</header>

	<!-- LOGO / NAMEING BOX -->
	<div class="row" style="margin-top: 30px; width: 100%;">
		<div class="col-md-6 order-1" style="padding-left: 5%; size: 10px;">
			<h1><span id="home_device_title"></span></h1>
			<h5><span id="home_device_subtitle"></span></h5>
		</div>
		<div id="clientLogo_box" class="col-md-6 order-2">
			<img id="clientLogo" src="assets/edc.png" alt="">
		</div>
	</div>

	<!-- CONTENT BOX -->
	<div style="margin-top: 5%;">
		<div class=" tab-content" id="myTabContent" style=" padding-left: 7%; padding-right: 5%;">
			<div class="tab-pane fade show active" id="home" role="tabpanel" aria-labelledby="home-tab"></div>
			<div class="tab-pane fade" id="user" role="tabpanel" aria-labelledby="user-tab"></div>
		</div>
	</div>

	<!-- Bootstrap core JavaScript
    ================================================== -->
	<!-- Placed at the end of the document so the pages load faster -->
	<script src="tools/bootstrap/bootstrap.min.js"></script>

	<div class="" style="text-align: center;">
		<span id="home_heap_info" style="color: #ffffff;">No information</span>
	</div>

	<footer style="overflow: hidden;">
		<div class="row" style="width: 100%;">
			<div id="footer_copyright" class="col-md-7">
				<div style="color: white; padding-left: 40px;">&copy; Electronic Design Chemnitz GmbH</div>
			</div>
			<div class="col-md-5">
				<div id="footer_contact">
					<div class="lang-de">
						<a style="color: white; padding-right: 20px;" href="https://www.ed-chemnitz.de.com/"
							target="_blank">Kontakt</a>
					</div>
					<div class="lang-en">
						<a style="color: white; padding-right: 20px;" href="https://www.ed-chemnitz.de.com/"
							target="_blank">Contact Us</a>
					</div>
				</div>
			</div>
		</div>
	</footer>

</body>

</html>