class jsonRPC_ws{constructor(e){this.idCounter=1,this.pendingRequests={},this.wsUrl=e,this.connect(),this.previousReadyState=null,this.check()}check(){this.checkInterval=setInterval(()=>{this.ws.readyState!==this.previousReadyState&&(this.previousReadyState=this.ws.readyState,console.log("WebSocket readyState:",this.ws.readyState),this.ws.readyState===WebSocket.OPEN?this.onConnected():this.onDisconnected())},100)}connect(){this.ws=new WebSocket(this.wsUrl),this.ws.onmessage=e=>{this.onConnected();try{let t=JSON.parse(e.data),{id:s,result:n,error:i}=t;this.pendingRequests[s]?(clearTimeout(this.pendingRequests[s].timeout),i?this.pendingRequests[s].reject(console.error("Websocket Error: "+i)):this.pendingRequests[s].resolve(n),delete this.pendingRequests[s]):this.handleAsync(t)}catch(o){this.handleAsync(e.data)}},this.ws.onerror=e=>{console.error("WebSocket error:",e),this.onDisconnected()},this.ws.onclose=()=>{this.onDisconnected(),console.warn("WebSocket connection closed, attempting to reconnect..."),setTimeout(()=>{this.connect()},1e3)}}onConnected(){console.log("Connected to WebSocket")}onDisconnected(){console.log("Disconnected from WebSocket")}handleAsync(e){this.onAsyncData?this.onAsyncData(e):console.log("Received data:",e)}call(e,t){return new Promise((s,n)=>{let i=this.idCounter++,o=setTimeout(()=>{this.pendingRequests[i]&&(n(console.warn("Websocket Timeout")),delete this.pendingRequests[i],this.onDisconnected(),this.check())},500);this.pendingRequests[i]={resolve:s,reject:n,timeout:o},this.ws.readyState===WebSocket.OPEN?this.ws.send(JSON.stringify({jsonrpc:"2.0",method:e,params:t,id:i})):(clearTimeout(o),n(console.warn("Websocket Closed")),this.onDisconnected(),this.check())})}}